global
    log stdout format raw local0
    maxconn 4096

defaults
    log     global
    mode    http
    option  httplog
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms

# Frontend that handles both HTTP and HTTPS on port 8000
frontend http-in
    bind :80
    mode http
    # Redirect all HTTP traffic to HTTPS
    http-request redirect scheme https code 301

frontend https-in
    bind :443
    mode tcp
    option tcplog
    
    # Wait for the client to send the SSL hello
    tcp-request inspect-delay 5s
    tcp-request content accept if { req_ssl_hello_type 1 }
    
    # Send all encrypted traffic to your proxy container
    default_backend jupyter_proxy_backend

backend jupyter_proxy_backend
    mode tcp
    # Points to your proxy container on its internal SSL port
    server proxy proxy:8443 check
